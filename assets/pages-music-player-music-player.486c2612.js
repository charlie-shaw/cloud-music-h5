import{j as e,s as a,l,q as s,k as t,J as o,o as n,c,w as u,i,a as r,m as d,b as v,u as p,p as m,t as h,g,h as f,F as y,K as _,f as b,L as x,x as k,S as w,v as C,e as L,r as $}from"./index-442b9388.js";import{q as F,_ as M}from"./music-list.16f6d15b.js";import{_ as T,o as j,m as I,n as P,f as E,b as S,c as U,r as D}from"./home.f5708a13.js";import{a as q,_ as H}from"./play_music.42b0c54c.js";import{t as R}from"./index-default.45a26e56.js";import{u as X,a as Y}from"./music-list-item.52a5d62c.js";const z=""+new URL("play_prev-e5d9edb2.png",import.meta.url).href,J=""+new URL("play_next-6044e02c.png",import.meta.url).href,K=T({__name:"music-player",setup(T){const K=X(),{playModeName:N,playSongList:V,currentIndex:W,playModelIndex:A,sliderValue:B,lyricInfos:G,scrollTop:O,itemHeight:Q,currentLyricIndex:Z,isPlaying:ee,currentTime:ae,durationTime:le,currentLyric:se,currentSong:te}=e(K),oe=a(!1),ne=l((()=>s().globalData.contentHeight));let ce=null;const ue=s().globalData.audioContext,ie=a(0);var re,de,ve,pe;j((e=>{ce=t().proxy;const{id:a,currentIndex:l}=e;fe(+a,l)}));const me=function(e){re=e.touches[0].pageX,ve=e.touches[0].pageY},he=function(e){de=e.touches[0].pageX,pe=e.touches[0].pageY,Math.abs(re-de)>Math.abs(ve-pe)&&e.preventDefault()};o((()=>{document.addEventListener("touchstart",me,!1),document.addEventListener("touchmove",he,{passive:!1})}));const ge=()=>{Ce.value||oe.value||be(),xe()},fe=async(e,a)=>{if(te.value.id!==e){const l=await I(e);Y(null==l?void 0:l.songs[0],a),ue.src||(console.log("listener"),ue.onCanplay(ye),ue.onTimeUpdate(ge),ue.onEnded(_e),ue.onPause((()=>{K.$patch({isPlaying:!1})})),ue.onPlay((()=>{K.$patch({isPlaying:!0})})),ue.onWaiting((()=>{ue.pause()})),ue.onError((e=>{console.log(e)})))}},ye=()=>{ue.play(),console.log("play"),ee.value=!0},_e=()=>{1!==A&&$e(!0,!0)},be=R((()=>{const e=1e3*ue.currentTime/le.value*100;B.value=e,ae.value=1e3*ue.currentTime}),800,{leading:!1}),xe=R((()=>{var e;if(!G.value.length)return;let a=G.value.length-1;for(let t=0;t<G.value.length;t++){if(G.value[t].time-100>1e3*ue.currentTime){a=t-1;break}}if(a===Z.value)return;Q.value||F(".height").then((e=>{var a;Q.value=null==(a=e[0])?void 0:a.height}));const l=ne.value/2,s=Q.value*a-l+Q.value/2;se.value=null==(e=G.value[a])?void 0:e.lyric,Z.value=a,O.value=s}),500,{leading:!1}),ke=()=>{ue.paused?(ue.play(),K.$patch({isPlaying:!0})):(ue.pause(),K.$patch({isPlaying:!1}))},we=e=>{oe.value=!0,setTimeout((()=>{oe.value=!1}),1e3);const a=e.detail.value;ue.seek(le.value*a/100/1e3),Ce.value=!1},Ce=a(!1),Le=e=>{Ce.value=!0;const a=e.detail.value;ae.value=le.value*a/100},$e=(e,a)=>{const l=K.playSongList.length;let s=W.value;switch(A.value){case 1:case 0:e?(s+=1,s=s>=l?0:s):(s-=1,s=s<0?l-1:s);break;case 2:for(s=Math.floor(Math.random()*l);s===W.value;)s=Math.floor(Math.random()*l)}if(a&&1===A.value)return;W.value=s,console.log(A.value,s);const t=[...V.value];t[s]&&Y(t[s],s)},Fe=()=>{$e(!0)},Me=()=>{$e()},Te=e=>{ie.value=e.detail.current},je=()=>{const e=["order","repeat","random"];switch(A.value+=1,A.value>=e.length&&(A.value=0),1===A.value?ue.loop=!0:ue.loop=!1,N.value=e[A.value],A.value){case 0:_({title:"顺序播放",icon:"success"});break;case 1:_({title:"单曲循环",icon:"success"});break;case 2:_({title:"随机播放",icon:"success"})}},Ie=()=>{ce.$refs.popup.open()},Pe=()=>{ce.$refs.popup.close()};return P((()=>{document.removeEventListener("touchstart",me),document.removeEventListener("touchmove",he)})),(e,a)=>{const l=i,s=b,t=x,o=k,_=w,F=C,T=L,j=D($("music-list"),M),I=D($("uni-popup"),H);return n(),c(l,{class:"container"},{default:u((()=>{var e,i;return[r(l,{class:"tabs"},{default:u((()=>[r(l,{class:d(0===ie.value?"active":""),onClick:a[0]||(a[0]=e=>ie.value=0)},{default:u((()=>[v(" 歌曲 ")])),_:1},8,["class"]),r(l,{class:"divider"},{default:u((()=>[v("|")])),_:1}),r(l,{class:d(1===ie.value?"active":""),onClick:a[1]||(a[1]=e=>ie.value=1)},{default:u((()=>[v(" 歌词 ")])),_:1},8,["class"])])),_:1}),r(s,{class:"bg-img",src:p(E)(null==(i=null==(e=p(te))?void 0:e.al)?void 0:i.picUrl),mode:"aspectFill"},null,8,["src"]),r(l,{class:"bg-cover"}),r(F,{current:ie.value,onChange:Te,class:"swiper",style:m(`height:${p(ne)}px`)},{default:u((()=>[r(o,null,{default:u((()=>[r(l,{class:"song-box",style:m(`height:${p(ne)}px`)},{default:u((()=>[r(l,{class:"song-cover"},{default:u((()=>{var e,a;return[r(s,{class:"cover",src:p(E)(null==(a=null==(e=p(te))?void 0:e.al)?void 0:a.picUrl),mode:"widthFix"},null,8,["src"])]})),_:1}),r(l,{class:"title"},{default:u((()=>[v(h(p(te).name),1)])),_:1}),r(l,{class:"ar"},{default:u((()=>[v(h(p(S)(p(te).ar)),1)])),_:1}),r(l,{class:"lyric"},{default:u((()=>[v(h(p(se)),1)])),_:1}),r(l,{class:"progress"},{default:u((()=>[r(t,{"active-color":"#1FD963","block-size":"12",onChange:we,onChanging:Le,value:p(B)},null,8,["value"]),r(l,{class:"time"},{default:u((()=>[r(l,{class:"current-tiem"},{default:u((()=>[v(h(p(U)(p(ae))),1)])),_:1}),r(l,{class:"duration-tiem"},{default:u((()=>[v(h(p(U)(p(le))),1)])),_:1})])),_:1})])),_:1}),r(l,{class:"controls"},{default:u((()=>[r(s,{class:"btn mode",src:`/static/images/player/play_${p(N)}.png`,mode:"widthFix",onClick:je},null,8,["src"]),r(s,{class:"btn prev",src:z,mode:"widthFix",onClick:Me}),r(s,{class:"btn play",src:`/static/images/player/play_${p(ee)?"pause":"resume"}.png`,mode:"widthFix",onClick:ke},null,8,["src"]),r(s,{class:"btn next",src:J,mode:"widthFix",onClick:Fe}),r(s,{class:"btn music",src:q,mode:"widthFix",onClick:Ie})])),_:1})])),_:1},8,["style"])])),_:1}),r(o,null,{default:u((()=>[r(_,{class:"lyric-list","scroll-y":"","scroll-top":`${p(O)}`,"scroll-with-animation":""},{default:u((()=>[(n(!0),g(y,null,f(p(G),((e,a)=>(n(),c(l,{key:e.time,class:d(`item ${p(Z)===a?"active":""} ${0===a?"height":""}`)},{default:u((()=>[v(h(e.lyric),1)])),_:2},1032,["class"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1},8,["current","style"]),r(I,{ref:"popup","background-color":"white",type:"bottom"},{default:u((()=>[r(j,{playSongList:p(V),height:p(ne)/2+"px",onItemClick:Pe},{title:u((()=>[v(" 当前播放列表 "),r(T,{class:"count"},{default:u((()=>[v("( "+h(p(V).length)+" )",1)])),_:1})])),_:1},8,["playSongList","height"])])),_:1},512)]})),_:1})}}},[["__scopeId","data-v-4dd75f12"]]);export{K as default};
