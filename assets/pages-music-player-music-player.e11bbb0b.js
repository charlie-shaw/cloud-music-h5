import{H as e,j as a,s as l,l as s,q as t,k as o,I as n,o as u,c,w as i,i as r,a as d,m as v,b as p,u as m,p as h,t as g,g as f,h as y,F as _,f as b,J as x,x as k,S as w,v as C,e as $,r as L}from"./index-93c86729.js";import{q as T,_ as F}from"./music-list.d228a9b4.js";import{_ as I,o as M,m as j,n as P,f as E,b as S,c as U,r as D}from"./home.3f015371.js";import{a as H,_ as q}from"./play_music.01385e3c.js";import{t as R}from"./index-default.45a26e56.js";import{u as X,a as Y}from"./music-list-item.1c110b9b.js";const z=""+new URL("play_prev-e5d9edb2.png",import.meta.url).href,J=""+new URL("play_next-6044e02c.png",import.meta.url).href,N=I({__name:"music-player",setup(I){const N=X(),{playModeName:V,playSongList:A,currentIndex:B,playModelIndex:G,sliderValue:K,lyricInfos:O,scrollTop:Q,itemHeight:W,currentLyricIndex:Z,isPlaying:ee,currentTime:ae,durationTime:le,currentLyric:se,currentSong:te}=a(N),oe=l(!1),ne=s((()=>t().globalData.contentHeight));let ue=null;const ce=t().globalData.audioContext,ie=l(0);var re,de,ve,pe;M((e=>{ue=o().proxy;const{id:a,currentIndex:l}=e;fe(+a,l)}));const me=function(e){re=e.touches[0].pageX,ve=e.touches[0].pageY},he=function(e){de=e.touches[0].pageX,pe=e.touches[0].pageY,Math.abs(re-de)>Math.abs(ve-pe)&&e.preventDefault()};n((()=>{document.addEventListener("touchstart",me,!1),document.addEventListener("touchmove",he,{passive:!1})}));const ge=()=>{Ce.value||oe.value||be(),xe()},fe=async(a,l)=>{if(te.value.id!==a){const s=await j(a);Y(null==s?void 0:s.songs[0],l),ce.src||(console.log("listener"),ce.onCanplay(ye),ce.onTimeUpdate(ge),ce.onEnded(_e),ce.onPause((()=>{N.$patch({isPlaying:!1})})),ce.onPlay((()=>{N.$patch({isPlaying:!0})})),ce.onError((a=>{console.log("加载失败"),e({title:"歌曲加载失败",icon:"error"}),A.value.length<=1?ce.pause():setTimeout((()=>{Te()}),1e3)})))}},ye=()=>{ce.play(),console.log("play"),N.durationTime=1e3*ce.duration,ee.value=!0},_e=()=>{1!==G&&Le(!0,!0)},be=R((()=>{const e=1e3*ce.currentTime/le.value*100;K.value=e,ae.value=1e3*ce.currentTime}),800,{leading:!1}),xe=R((()=>{var e;if(!O.value.length)return;let a=O.value.length-1;for(let t=0;t<O.value.length;t++){if(O.value[t].time-100>1e3*ce.currentTime){a=t-1;break}}if(a===Z.value)return;W.value||T(".height").then((e=>{var a;W.value=null==(a=e[0])?void 0:a.height}));const l=ne.value/2,s=W.value*a-l+W.value/2;se.value=null==(e=O.value[a])?void 0:e.lyric,Z.value=a,Q.value=s}),500,{leading:!1}),ke=()=>{ce.paused?(ce.play(),N.$patch({isPlaying:!0})):(ce.pause(),N.$patch({isPlaying:!1}))},we=e=>{oe.value=!0,setTimeout((()=>{oe.value=!1}),1e3);const a=e.detail.value;ce.seek(le.value*a/100/1e3),Ce.value=!1},Ce=l(!1),$e=e=>{Ce.value=!0;const a=e.detail.value;ae.value=le.value*a/100},Le=(e,a)=>{const l=N.playSongList.length;let s=B.value;switch(G.value){case 1:case 0:e?(s+=1,s=s>=l?0:s):(s-=1,s=s<0?l-1:s);break;case 2:for(s=Math.floor(Math.random()*l);s===B.value;)s=Math.floor(Math.random()*l)}if(a&&1===G.value)return;B.value=s,console.log(G.value,s);const t=[...A.value];t[s]&&Y(t[s],s)},Te=()=>{Le(!0)},Fe=()=>{Le()},Ie=e=>{ie.value=e.detail.current},Me=()=>{const a=["order","repeat","random"];switch(G.value+=1,G.value>=a.length&&(G.value=0),1===G.value?ce.loop=!0:ce.loop=!1,V.value=a[G.value],G.value){case 0:e({title:"顺序播放",icon:"success"});break;case 1:e({title:"单曲循环",icon:"success"});break;case 2:e({title:"随机播放",icon:"success"})}},je=()=>{ue.$refs.popup.open()},Pe=()=>{ue.$refs.popup.close()};return P((()=>{document.removeEventListener("touchstart",me),document.removeEventListener("touchmove",he)})),(e,a)=>{const l=r,s=b,t=x,o=k,n=w,T=C,I=$,M=D(L("music-list"),F),j=D(L("uni-popup"),q);return u(),c(l,{class:"container"},{default:i((()=>{var e,r;return[d(l,{class:"tabs"},{default:i((()=>[d(l,{class:v(0===ie.value?"active":""),onClick:a[0]||(a[0]=e=>ie.value=0)},{default:i((()=>[p(" 歌曲 ")])),_:1},8,["class"]),d(l,{class:"divider"},{default:i((()=>[p("|")])),_:1}),d(l,{class:v(1===ie.value?"active":""),onClick:a[1]||(a[1]=e=>ie.value=1)},{default:i((()=>[p(" 歌词 ")])),_:1},8,["class"])])),_:1}),d(s,{class:"bg-img",src:m(E)(null==(r=null==(e=m(te))?void 0:e.al)?void 0:r.picUrl),mode:"aspectFill"},null,8,["src"]),d(l,{class:"bg-cover"}),d(T,{current:ie.value,onChange:Ie,class:"swiper",style:h(`height:${m(ne)}px`)},{default:i((()=>[d(o,null,{default:i((()=>[d(l,{class:"song-box",style:h(`height:${m(ne)}px`)},{default:i((()=>[d(l,{class:"song-cover"},{default:i((()=>{var e,a;return[d(s,{class:"cover",src:m(E)(null==(a=null==(e=m(te))?void 0:e.al)?void 0:a.picUrl),mode:"widthFix"},null,8,["src"])]})),_:1}),d(l,{class:"title"},{default:i((()=>[p(g(m(te).name),1)])),_:1}),d(l,{class:"ar"},{default:i((()=>[p(g(m(S)(m(te).ar)),1)])),_:1}),d(l,{class:"lyric"},{default:i((()=>[p(g(m(se)),1)])),_:1}),d(l,{class:"progress"},{default:i((()=>[d(t,{"active-color":"#1FD963","block-size":"12",onChange:we,onChanging:$e,value:m(K)},null,8,["value"]),d(l,{class:"time"},{default:i((()=>[d(l,{class:"current-tiem"},{default:i((()=>[p(g(m(U)(m(ae))),1)])),_:1}),d(l,{class:"duration-tiem"},{default:i((()=>[p(g(m(U)(m(le))),1)])),_:1})])),_:1})])),_:1}),d(l,{class:"controls"},{default:i((()=>[d(s,{class:"btn mode",src:`/static/images/player/play_${m(V)}.png`,mode:"widthFix",onClick:Me},null,8,["src"]),d(s,{class:"btn prev",src:z,mode:"widthFix",onClick:Fe}),d(s,{class:"btn play",src:`/static/images/player/play_${m(ee)?"pause":"resume"}.png`,mode:"widthFix",onClick:ke},null,8,["src"]),d(s,{class:"btn next",src:J,mode:"widthFix",onClick:Te}),d(s,{class:"btn music",src:H,mode:"widthFix",onClick:je})])),_:1})])),_:1},8,["style"])])),_:1}),d(o,null,{default:i((()=>[d(n,{class:"lyric-list","scroll-y":"","scroll-top":`${m(Q)}`,"scroll-with-animation":""},{default:i((()=>[(u(!0),f(_,null,y(m(O),((e,a)=>(u(),c(l,{key:e.time,class:v(`item ${m(Z)===a?"active":""} ${0===a?"height":""}`)},{default:i((()=>[p(g(e.lyric),1)])),_:2},1032,["class"])))),128))])),_:1},8,["scroll-top"])])),_:1})])),_:1},8,["current","style"]),d(j,{ref:"popup","background-color":"white",type:"bottom"},{default:i((()=>[d(M,{playSongList:m(A),height:m(ne)/2+"px",onItemClick:Pe},{title:i((()=>[p(" 当前播放列表 "),d(I,{class:"count"},{default:i((()=>[p("( "+g(m(A).length)+" )",1)])),_:1})])),_:1},8,["playSongList","height"])])),_:1},512)]})),_:1})}}},[["__scopeId","data-v-5e7e3815"]]);export{N as default};
